<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>üì¶ Acompanhamento de Pedidos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest-admin.json">
<meta name="theme-color" content="#0b1220">

<style>
/* =========================================================
   THEME (MESMO DO admin.html)
========================================================= */
:root{
  --bg:#f8fafc;
  --card:#ffffff;
  --muted:#6b7280;
  --text:#0f172a;
  --border:#e5e7eb;

  --navy-1:#0b1220;
  --navy-2:#0f1b33;

  --primary:#16a34a;
  --primary-hover:#15803d;

  --secondary:#2563eb;
  --secondary-hover:#1d4ed8;

  --danger:#dc2626;
  --danger-hover:#b91c1c;

  --warn:#f59e0b;

  --shadow: 0 6px 16px rgba(15, 23, 42, .06);
  --shadow-soft: 0 2px 8px rgba(15, 23, 42, .05);

  --radius:18px;
  --max:1200px;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
  color:var(--text);
  background: var(--bg);
  font-size:16px;
}

/* =========================================================
   TOPBAR (MINIMAL)
========================================================= */
.topbar{
  position: sticky;
  top:0;
  z-index: 900;
  padding: 8px 10px 10px;
  color:#fff;
  background:
    radial-gradient(1200px 320px at 10% -10%, rgba(37,99,235,.30), transparent 55%),
    radial-gradient(900px 280px at 90% 0%, rgba(22,163,74,.18), transparent 60%),
    linear-gradient(180deg, var(--navy-2), var(--navy-1));
  box-shadow: none;
}
.topbar-inner{
  max-width: var(--max);
  margin: 0 auto;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.topbar-right{
  display:flex;
  align-items:center;
  gap:10px;
}

/* BOT√ïES PADRONIZADOS (menores) */
.icon-ctl{
  position:relative;
  appearance:none;
  border:none;
  cursor:pointer;
  color:#fff;
  width:36px;
  height:36px;
  border-radius: 12px;
  font-size:18px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.14);
  box-shadow: none;
}
.icon-ctl:active{ transform: scale(.98); }

/* chip status compacto */
.status-chip{
  display:flex;
  align-items:center;
  gap:7px;
  padding: 7px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: none;
  font-size: 12px;
  font-weight: 900;
  line-height: 1;
  white-space:nowrap;
}
.status-chip .sep{ opacity:.75; }
.status-chip b{ min-width: 14px; text-align:center; }
.status-chip .dot{
  width:7px;
  height:7px;
  border-radius:999px;
  display:inline-block;
}
.status-chip .dot.pend{ background: rgba(245,158,11,.95); }
.status-chip .dot.apr{  background: rgba(34,197,94,.95); }
.status-chip .dot.res{  background: rgba(59,130,246,.95); }

/* logo compacto */
.logo-suzano.compact{
  padding: 6px 8px;
  border-radius: 12px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.12);
}
.logo-suzano.compact img{
  width: 72px;
  height:auto;
  display:block;
  filter: drop-shadow(0 8px 14px rgba(0,0,0,.20));
}

@media (max-width: 380px){
  .status-chip{ padding: 6px 8px; font-size: 11px; gap:6px; }
  .icon-ctl{ width:34px; height:34px; border-radius: 11px; font-size:17px; }
  .logo-suzano.compact img{ width: 64px; }
}

/* =========================================================
   PAGE / PANEL
========================================================= */
.page{
  max-width: var(--max);
  margin: -10px auto 104px;
  padding: 0 14px 22px;
}
.panel{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: none;
  overflow: visible;
  margin-top: 12px;
}
.panel-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 14px 14px 10px;
  border-bottom:1px solid rgba(229,231,235,.7);
  background: #fff;
}
.panel-header .h{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight: 900;
  font-size: 16px;
}
.panel-header small{
  color: var(--muted);
  font-size: 12px;
}
.panel-body{ padding: 14px; }

/* =========================================================
   CARDS (MESMO VISUAL DO admin atual + seu ‚Äúmodelo antigo‚Äù)
========================================================= */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(340px, 1fr));
  gap:14px;
  margin-top: 14px;
}

/* card base */
.order-card{
  position: relative;
  border-radius: 18px;
  overflow: hidden; /* üîë faixa respeita a curva */
  border: 1px solid rgba(229,231,235,.95);
}

/* faixa lateral estreita */
.order-card::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:4px;
  background:#e5e7eb;
}

/* fundo do card por status */
.order-card.pendente{
  background: rgba(245,158,11,.14);
  border-color: rgba(245,158,11,.22);
}
.order-card.pendente::before{ background: rgba(245,158,11,.95); }

.order-card.aprovado{
  background: rgba(34,197,94,.12);
  border-color: rgba(34,197,94,.20);
}
.order-card.aprovado::before{ background: rgba(22,163,74,.95); }

.order-card.reprovado{
  background: rgba(239,68,68,.12);
  border-color: rgba(239,68,68,.20);
}
.order-card.reprovado::before{ background: rgba(220,38,38,.95); }

.order-card.reservado{
  background: rgba(59,130,246,.12);
  border-color: rgba(59,130,246,.20);
}
.order-card.reservado::before{ background: rgba(37,99,235,.95); }

/* topo */
.card-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 12px 12px 8px;
  background: transparent;
  border-bottom: 1px solid rgba(15,23,42,.08);
}

/* status s√≥ texto */
.status-pill{
  display:inline-flex;
  align-items:center;
  font-weight: 950;
  font-size: 16px;
  padding: 0;
  border: 0;
  background: transparent;
}
.status-pill.pendente{ color: rgba(124,74,3,.95); }
.status-pill.aprovado{ color: rgba(6,95,70,.95); }
.status-pill.reprovado{ color: rgba(153,27,27,.95); }
.status-pill.reservado{ color: rgba(30,64,175,.95); }

.btn-excluir{
  border:none;
  background: rgba(15,23,42,.06);
  border: 1px solid rgba(15,23,42,.08);
  width: 38px;
  height: 38px;
  border-radius: 12px;
  cursor:pointer;
  font-size:18px;
  line-height: 1;
  color:#dc2626;
}
.btn-excluir:hover{ background: rgba(220,38,38,.10); border-color: rgba(220,38,38,.18); }

.card-body-inner{ padding: 12px; }

.info{ margin-bottom:8px; font-size: 15px; }
.info b{
  display:block;
  color:#374151;
  font-size: 12px;
  margin-bottom: 2px;
}

.selo{
  background:#f3f4f6;
  border: 1px solid rgba(229,231,235,.9);
  padding:10px;
  border-radius: 14px;
  text-align:center;
  font-weight: 900;
  color:#0f172a;
  margin-top: 12px;
}

.selo-devolucao{
  background:#dbeafe;
  color:#1e40af;
  font-weight:900;
  text-align:center;
  padding:8px 10px;
  border-radius: 14px;
  border: 1px solid rgba(37,99,235,.22);
  margin: 10px 0 8px;
}

.peca{
  margin-top:10px;
  padding-top:8px;
  border-top:1px dashed #d1d5db;
}
.peca b{ display:block; font-weight: 900; }
.peca input{
  width:100%;
  padding: 11px 12px;
  margin-top: 8px;
  border-radius: 14px;
  border: 1px solid var(--border);
  font-size: 16px;
  background:#fff;
}

/* =========================================================
   SIDEBAR / OVERLAY (igual admin)
========================================================= */
.menu-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  z-index:1000;
  display:none;
}
.menu-overlay.active{ display:block; }

.sidebar{
  position:fixed;
  top:0;
  left:0;
  height:100%;
  width:270px;
  background: linear-gradient(180deg, #0b1220, #0f1b33);
  color:#fff;
  transform:translateX(-100%);
  transition:.25s;
  z-index:1001;
  display:flex;
  flex-direction:column;
  box-shadow: none;
}
.sidebar.active{ transform:translateX(0); }

.sidebar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  border-bottom:1px solid rgba(255,255,255,.10);
}
.sidebar-header button{
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.16);
  color:#fff;
  width: 36px;
  height: 36px;
  border-radius: 12px;
  cursor:pointer;
}
.sidebar nav{
  display:flex;
  flex-direction:column;
  padding:10px;
  gap:8px;
}
.sidebar nav a{
  padding:12px;
  border-radius:14px;
  color:#fff;
  text-decoration:none;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.08);
}
.sidebar nav a:hover{ background: rgba(255,255,255,.10); }
.sidebar nav a.ativo{ background: rgba(37,99,235,.35); border-color: rgba(37,99,235,.40); }

/* =========================================================
   BOTTOM NAV (igual admin)
========================================================= */
.bottom-nav{
  position: fixed;
  left: 0; right: 0;
  bottom: 0;
  z-index: 800;
  padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
  background: rgba(11,18,32,.92);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255,255,255,.08);
}
.bottom-nav .inner{
  max-width: 520px;
  margin:0 auto;
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}
.nav-btn{
  display:flex;
  flex-direction:column;
  gap:4px;
  align-items:center;
  justify-content:center;
  text-decoration:none;
  color:#e5e7eb;
  font-size: 11px;
  padding: 10px 8px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.06);
  transition: .15s;
}
.nav-btn:hover{ background: rgba(255,255,255,.10); }
.nav-btn span.icon{ font-size: 18px; line-height: 1; }
.nav-btn.active{
  color:#fff;
  background: rgba(37,99,235,.28);
  border-color: rgba(37,99,235,.45);
  box-shadow: 0 10px 18px rgba(37,99,235,.15);
}
.nav-btn.active .icon{
  filter: drop-shadow(0 6px 12px rgba(37,99,235,.35));
}

footer{
  text-align:center;
  margin: 16px 0 110px;
  font-size:11px;
  color: var(--muted);
}
</style>
</head>

<body>

<!-- TOPBAR -->
<header class="topbar">
  <div class="topbar-inner">
    <button class="icon-ctl" onclick="abrirMenu()" aria-label="Abrir menu">‚ò∞</button>

    <div class="status-chip" id="statusChip" title="Pendentes ‚Ä¢ Aprovados ‚Ä¢ Reservados">
      <span class="dot pend"></span><b id="chipPend">0</b>
      <span class="sep">‚Ä¢</span>
      <span class="dot apr"></span><b id="chipApr">0</b>
      <span class="sep">‚Ä¢</span>
      <span class="dot res"></span><b id="chipRes">0</b>
    </div>

    <div class="topbar-right">
      <div class="logo-suzano compact">
        <img src="suzano-logo.png" alt="Suzano">
      </div>
    </div>
  </div>
</header>

<!-- OVERLAY -->
<div class="menu-overlay" onclick="fecharMenu()"></div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-header">
    <strong>üì¶ Pedido de Pe√ßas</strong>
    <button onclick="fecharMenu()" aria-label="Fechar menu">‚úñ</button>
  </div>
  <nav>
    <a href="index.html">üìù Pedido de Pe√ßas</a>
    <a href="acompanhamento.html">üì¶ Acompanhamento de Pedidos üî©</a>
    <a href="admin.html">üîê √Årea de T√©cnicos üõ†Ô∏è</a>
    <a href="admin-epi.html">ü¶∫ EPI's e Uniformes</a>
    <a href="painel-almoxarife.html">üñ•Ô∏è Painel do Almoxarife ‚öôÔ∏è</a>
  </nav>
</aside>

<main class="page">
  <section class="panel">
    <div class="panel-header">
      <div class="h">üì¶ Acompanhamento de pedidos</div>
      <small>√öltimos 25 pedidos</small>
    </div>

    <div class="panel-body">
      <div class="cards" id="lista"></div>
    </div>
  </section>

  <footer>Criado e Desenvolvido por Cleider Filho</footer>
</main>

<!-- BOTTOM NAV -->
<nav class="bottom-nav" aria-label="Acessos">
  <div class="inner">
    <a class="nav-btn" data-nav="pedido" href="index.html">
      <span class="icon">üìù</span>
      <span>Pedido</span>
    </a>
    <a class="nav-btn" data-nav="tecnicos" href="admin.html">
      <span class="icon">üîê</span>
      <span>T√©cnicos</span>
    </a>
    <a class="nav-btn" data-nav="acomp" href="acompanhamento.html">
      <span class="icon">üì¶</span>
      <span>Acomp.</span>
    </a>
    <a class="nav-btn" data-nav="painel" href="painel-almoxarife.html">
      <span class="icon">üñ•Ô∏è</span>
      <span>Painel</span>
    </a>
  </div>
</nav>

<script type="module">
/* =========================================================
   IMPORTS
========================================================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs,
  doc, updateDoc, getDoc, query, orderBy,
  deleteDoc, limit
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* =========================================================
   FIREBASE
========================================================= */
const app = initializeApp({
  apiKey: "AIzaSyCAJPyQ7-a4Efxxh5yTXQ_326hn22OYAuc",
  authDomain: "pedidos-almoxarifado.firebaseapp.com",
  projectId: "pedidos-almoxarifado",
  storageBucket: "pedidos-almoxarifado.firebasestorage.app",
  messagingSenderId: "443882865992",
  appId: "1:443882865992:web:1afcc37c29bd8800eedf7d"
});

const db = getFirestore(app);

/* =========================================================
   ELEMENTOS UI
========================================================= */
const lista = document.getElementById("lista");

/* chip */
const chipPend = document.getElementById("chipPend");
const chipApr  = document.getElementById("chipApr");
const chipRes  = document.getElementById("chipRes");

/* =========================================================
   CONTADORES (chip topo)
========================================================= */
function atualizarChip(pedidos){
  const pend = pedidos.filter(p => p.status === "Pendente").length;
  const apr  = pedidos.filter(p => p.status === "Aprovado").length;
  const res  = pedidos.filter(p => p.status === "Reservado").length;

  chipPend.textContent = pend;
  chipApr.textContent  = apr;
  chipRes.textContent  = res;
}

/* =========================================================
   CARREGAR PEDIDOS (mant√©m input + exclus√£o)
========================================================= */
async function carregarPedidos(){
  lista.innerHTML = "";

  const q = query(
    collection(db,"pedidos"),
    orderBy("criadoEm","desc"),
    limit(25)
  );

  const snap = await getDocs(q);
  const pedidos = [];
  snap.forEach(d => pedidos.push({ id:d.id, ...d.data() }));

  // pendentes primeiro
  pedidos.sort((a,b)=>{
    if(a.status==="Pendente" && b.status!=="Pendente") return -1;
    if(a.status!=="Pendente" && b.status==="Pendente") return 1;
    return 0;
  });

  atualizarChip(pedidos);

  pedidos.forEach(p=>{
    const statusLower = (p.status || "").toLowerCase();
    const finalizado = (p.status === "Reprovado" || p.status === "Reservado");

    lista.innerHTML += `
      <div class="order-card ${statusLower}" id="card-${p.id}">
        <div class="card-top">
          <div class="status-pill ${statusLower}">${p.status || "-"}</div>

          ${!finalizado ? `
            <button class="btn-excluir" onclick="excluir('${p.id}')" title="Excluir">‚úï</button>
          ` : `<div></div>`}
        </div>

        <div class="card-body-inner">
          ${p.tipo==="DEVOLUCAO" ? `<div class="selo-devolucao">üîÅ PEDIDO DE DEVOLU√á√ÉO</div>` : ""}

          <div class="info"><b>Solicitante</b>${p.nome || "-"}</div>
          <div class="info"><b>Manuten√ß√£o</b>${p.manutencao || "-"}</div>
          <div class="info"><b>GO</b>${p.go || "-"}</div>

          <div class="info"><b>Pe√ßas</b></div>

          ${(p.pecas || []).map((x,i)=>`
            <div class="peca">
              <b>${x.descricao || "-"} (${x.quantidade || "-"})</b>
              <input
                value="${x.ni || ""}"
                ${finalizado ? "disabled" : ""}
                onchange="atualizarNI('${p.id}',${i},this.value)"
              >
            </div>
          `).join("")}

          <div class="selo">
            ${
              p.status === "Pendente" ? "üü† Pedido Pendente" :
              p.status === "Aprovado" ? `‚úî Pedido Aprovado<br>üë∑‚Äç‚ôÇÔ∏è ${p.aprovadoPor||"-"}` :
              p.status === "Reservado" ? `‚úî Pedido Reservado<br>üë∑‚Äç‚ôÇÔ∏è Aprovado: ${p.aprovadoPor||"-"}<br>üì¶ Reservado: ${p.reservadoPor||"-"}` :
              "‚ùå Pedido Reprovado"
            }
          </div>
        </div>
      </div>
    `;
  });
}
window.carregarPedidos = carregarPedidos;

/* =========================================================
   NI (mantido)
========================================================= */
window.atualizarNI = async (id, i, ni) => {
  const ref = doc(db,"pedidos",id);
  const snap = await getDoc(ref);
  if(!snap.exists()) return;

  const p = snap.data();
  if (!p.pecas || !p.pecas[i]) return;

  p.pecas[i].ni = (ni || "").trim();
  await updateDoc(ref, { pecas: p.pecas });

  carregarPedidos(); // mant√©m seu comportamento atual
};

/* =========================================================
   EXCLUIR (mantido)
========================================================= */
window.excluir = async (id) => {
  if(!confirm("Excluir pedido pendente?")) return;
  await deleteDoc(doc(db,"pedidos",id));
  carregarPedidos();
};

/* =========================================================
   MENU + ACTIVE STATES
========================================================= */
window.abrirMenu = () => {
  document.querySelector(".sidebar").classList.add("active");
  document.querySelector(".menu-overlay").classList.add("active");
};
window.fecharMenu = () => {
  document.querySelector(".sidebar").classList.remove("active");
  document.querySelector(".menu-overlay").classList.remove("active");
};

/* destaca p√°gina atual */
document.querySelectorAll(".sidebar nav a").forEach(a=>{
  if(a.href === window.location.href){
    a.classList.add("ativo");
  }
});

/* Bottom nav ativo (acompanhamento) */
(function marcarNavAtiva(){
  const path = (location.pathname.split("/").pop() || "acompanhamento.html").toLowerCase();
  const map = {
    "index.html": "pedido",
    "admin.html": "tecnicos",
    "acompanhamento.html": "acomp",
    "painel-almoxarife.html": "painel"
  };
  const key = map[path] || "acomp";
  document.querySelectorAll(".nav-btn").forEach(a=>{
    if (a.dataset.nav === key) a.classList.add("active");
  });
})();

/* init */
carregarPedidos();
</script>

</body>
</html>
